[
    {
        "id_lesson": 279275,
        "steps": [
            {
                "id_step": 1032499,
                "text": {
                    "text": "Содержание урока\nSQL запросы позволяют производить вычисления не только для каждой строки таблицы, но и для группы элементов, расположенных в одном столбце. Для этого используются групповые (агрегатные) функции. \nНа этом уроке рассмотрим запросы, которые реализуют:\n\nвыборку уникальных элементов столбца;\nвыборку данных (групповые функции sum и count);\nвыборку данных (групповые функции min, max и avg);\nвыборку данных с вычислением (групповые функции);\nвычисления по таблице целиком;\nвыборку данных по условию (групповые функции)\nвыборка данных по условию (групповые функции WHERE и HAVING).\n\nСтруктура и наполнение таблицы\nВсе запросы будут формулироваться для таблицы book(создание, заполнение):\n\n[TABLE]\n",
                    "tables": [
                        "{\"0\":{\"0\":\"book_id\",\"1\":\"INT PRIMARY KEY AUTO_INCREMENT\",\"2\":\"1\",\"3\":\"2\",\"4\":\"3\",\"5\":\"4\",\"6\":\"5\",\"7\":\"6\"},\"1\":{\"0\":\"title\",\"1\":\"VARCHAR(50)\",\"2\":\"Мастер и Маргарита\",\"3\":\"Белая гвардия\",\"4\":\"Идиот\",\"5\":\"Братья Карамазовы\",\"6\":\"Игрок\",\"7\":\"Стихотворения и поэмы\"},\"2\":{\"0\":\"author\",\"1\":\"VARCHAR(30)\",\"2\":\"Булгаков М.А.\",\"3\":\"Булгаков М.А.\",\"4\":\"Достоевский Ф.М.\",\"5\":\"Достоевский Ф.М.\",\"6\":\"Достоевский Ф.М.\",\"7\":\"Есенин С.А.\"},\"3\":{\"0\":\"price\",\"1\":\"DECIMAL(8,2)\",\"2\":\"670.99\",\"3\":\"540.50\",\"4\":\"460.00\",\"5\":\"799.01\",\"6\":\"480.50\",\"7\":\"650.00\"},\"4\":{\"0\":\"amount\",\"1\":\"INT\",\"2\":\"3\",\"3\":\"5\",\"4\":\"10\",\"5\":\"3\",\"6\":\"10\",\"7\":\"15\"}}"
                    ]
                }
            },
            {
                "id_step": 1061916,
                "text": {
                    "text": "Выбор уникальных элементов столбца\nЧтобы отобрать уникальные элементы некоторого столбца используется ключевое слово DISTINCT, которое размещается сразу после SELECT.\nПример\nВыбрать различных авторов, книги которых хранятся в таблице book.\nЗапрос:\nSELECT DISTINCT author\nFROM book;\nРезультат:\n+------------------+\n| author           |\n+------------------+\n| Булгаков М.А.    |\n| Достоевский Ф.М. |\n| Есенин С.А.      |\n+------------------+\nДругой способ – использование оператора GROUP BY, который группирует данные при выборке, имеющие одинаковые значения в некотором столбце. Столбец, по которому осуществляется группировка, указывается после GROUP BY .\nС помощью GROUP BY можно выбрать уникальные элементы столбца, по которому осуществляется группировка. Результат будет точно такой же как при использовании DISTINCT.\nЗапрос:\nSELECT  author\nFROM book\nGROUP BY author;\nЗадание\nОтобрать различные (уникальные) элементы столбца amount таблицы book.\nРезультат (попробуйте решать задания без известного результата, если не получится - раскройте его)\nQuery result:\n+--------+\n| amount |\n+--------+\n| 3      |\n| 5      |\n| 10     |\n| 15     |\n+--------+\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1062280,
                "text": {
                    "text": "Выборка данных, групповые функции SUM и COUNT\nПри группировке над элементами столбца, входящими в группу можно выполнить различные действия, например, просуммировать их или найти количество элементов в группе.\nПодробно рассмотрим, как осуществляется группировка данных по некоторому столбцу и вычисления над группой на следующем примере:\nSELECT author, sum(amount), count(amount)\nFROM book\nGROUP BY author;\n1. В таблице book определяются строки, в которых в столбце author одинаковые значения:\n\nПолучили 3 различные группы:\n\nгруппа I объединяет две записи, у которых в столбце author значение Булгаков М.А.;\nгруппа II объединяет три записи, у которых в столбце author значение Достоевский Ф.М.;\nгруппа III объединяет одну запись, у которой в столбце author значение Есенин С.А.\n\n2. Вместо каждой группы в результирующий запрос включается  одна запись. Запись как минимум включает значение столбца, по которому осуществляется группировка (в нашем случае это author):\n\n3. Дальше можно выполнить вычисления над элементами КАЖДОЙ группы в отдельности, например, посчитать общее количество экземпляров книг каждого автора. Для этого используется групповая функция SUM(), а в скобках указывается столбец, по которому нужно выполнить суммирование ( в нашем случае amount):\n\n4. Также можно посчитать, сколько записей относится к группе. Для этого используется функция COUNT(), в скобках можно указать ЛЮБОЙ столбец из группы, если группа не содержит пустых значений (ниже приведен пример, в котором показано, как работает COUNT(), если в группе есть пустые значения):\n\nПример\nПосчитать, сколько экземпляров книг каждого автора хранится на складе.\nЗапрос:\nSELECT author, SUM(amount)\nFROM book\nGROUP BY author;\nРезультат:\n+------------------+-------------+\n| author           | SUM(amount) |\n+------------------+-------------+\n| Булгаков М.А.    | 8           |\n| Достоевский Ф.М. | 23          |\n| Есенин С.А.      | 15          |\n+------------------+-------------+\nПримечание\nОбратите внимание, что в качестве названия вычисляемого столбца в результирующей таблице используется выражение. Рекомендуется всем  вычисляемым столбцам давать имя.\n\nПример\nПосчитать, сколько различных книг каждого автора хранится на складе.\nТолько для этого примера в таблицу book добавлена запись с пустыми значениями в столбцах amount и price:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n| 7       | Черный человек        | Есенин С.А.      | Null   | Null   |\n+---------+-----------------------+------------------+--------+--------+\nЗапрос:\n/* чтобы проверить запрос, добавьте в таблицу строку */\nINSERT INTO book (title, author, price, amount) VALUES ('Черный человек','Есенин С.А.', Null, Null);\n\nSELECT author, COUNT(author), COUNT(amount), COUNT(*)\nFROM book\nGROUP BY author;\nРезультат:\n+------------------+---------------+---------------+----------+\n| author           | COUNT(author) | COUNT(amount) | COUNT(*) |\n+------------------+---------------+---------------+----------+\n| Булгаков М.А.    | 2             | 2             | 2        |\n| Достоевский Ф.М. | 3             | 3             | 3        |\n| Есенин С.А.      | 2             | 1             | 2        |\n+------------------+---------------+---------------+----------+\nИз таблицы с результатами запроса видно, что функцию COUNT() можно применять к любому столбцу, в том числе можно использовать и *, если таблица не содержит пустых значений. Если же в столбцах есть значения Null, (для группы по автору Есенин в нашем примере), то\n\nCOUNT(*) —  подсчитывает  все записи, относящиеся к группе, в том числе и со значением NULL;\nCOUNT(имя_столбца) — возвращает количество записей конкретного столбца (только NOT NULL), относящихся к группе.\n\nВАЖНО.\n\nЕсли столбец указан в SELECT  БЕЗ применения групповой функции, то он обязательно должен быть указан и вGROUP BY.Иначе получим ошибку.\nМежду названием функции и скобкой НЕЛЬЗЯ СТАВИТЬ ПРОБЕЛ. Это особенность платформы.\n\nЗадание\nПосчитать, количество различных книг и количество экземпляров книг каждого автора , хранящихся на складе.  Столбцы назвать Автор, Различных_книг и Количество_экземпляров соответственно.\nРезультат\n+------------------+----------------+------------------------+\n| Автор            | Различных_книг | Количество_экземпляров |\n+------------------+----------------+------------------------+\n| Булгаков М.А.    | 2              | 8                      |\n| Достоевский Ф.М. | 3              | 23                     |\n| Есенин С.А.      | 1              | 15                     |\n+------------------+----------------+------------------------+\n\n\nПояснение\nНазвание столбцов может состоять из нескольких слов, тогда их нужно заключать в кавычки. Но если слова написать через подчеркивание, тогда получится , что название состоит из одного слова, и кавычки можно не ставить. \n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1063123,
                "text": {
                    "text": "Выборка данных, групповые функции MIN, MAX и AVG\nК групповым функциям SQL относятся: MIN(), MAX() и AVG(), которые вычисляют минимальное, максимальное и среднее значение элементов столбца, относящихся к группе.\nПример\nВывести минимальную цену книги каждого автора\nЗапрос:\nSELECT author, MIN(price) AS min_price\nFROM book\nGROUP BY author;\nРезультат:\n+------------------+-----------+\n| author           | min_price |\n+------------------+-----------+\n| Булгаков М.А.    | 540.50    |\n| Достоевский Ф.М. | 460.00    |\n| Есенин С.А.      | 650.00    |\n+------------------+-----------+\nЗадание\nВывести фамилию и инициалы автора, минимальную, максимальную и среднюю цену книг каждого автора . Вычисляемые столбцы назвать Минимальная_цена, Максимальная_цена и Средняя_цена соответственно.\nРезультат\n+------------------+------------------+-------------------+--------------+\n| author           | Минимальная_цена | Максимальная_цена | Средняя_цена |\n+------------------+------------------+-------------------+--------------+\n| Булгаков М.А.    | 540.50           | 670.99            | 605.745000   |\n| Достоевский Ф.М. | 460.00           | 799.01            | 579.836667   |\n| Есенин С.А.      | 650.00           | 650.00            | 650.000000   |\n+------------------+------------------+-------------------+--------------+\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1063245,
                "text": {
                    "text": "Выборка данных c вычислением, групповые функции\nВ качестве аргумента групповых функций  SQL может использоваться не только столбец, но и любое допустимое в SQL арифметическое выражение.\nПример\nВывести суммарную стоимость книг каждого автора.\nЗапрос:\nSELECT author, SUM(price * amount) AS Стоимость\nFROM book\nGROUP BY author;\nРезультат:\n+------------------+-----------+\n| author           | Стоимость |\n+------------------+-----------+\n| Булгаков М.А.    | 4715.47   |\n| Достоевский Ф.М. | 11802.03  |\n| Есенин С.А.      | 9750.00   |\n+------------------+-----------+\nГрупповые функции могут быть элементами выражений. Например, при вычислении средней стоимости книг каждого автора на предыдущем шаге получились значения с шестью знаками после запятой. А поскольку это деньги, значения нужно округлить до 2 знаков после запятой.\n Пример\nНайти среднюю цену книг каждого автора.\nЗапрос:\nSELECT author, ROUND(AVG(price),2) AS Средняя_цена\nFROM book\nGROUP BY author;\nРезультат:\n+------------------+--------------+\n| author           | Средняя_цена |\n+------------------+--------------+\n| Булгаков М.А.    | 605.75       |\n| Достоевский Ф.М. | 579.84       |\n| Есенин С.А.      | 650.00       |\n+------------------+--------------+\n\nЗадание\nДля каждого автора вычислить суммарную стоимость книг S (имя столбца Стоимость), а также вычислить налог на добавленную стоимость  для полученных сумм (имя столбца НДС ) , который включен в стоимость и составляет 18% (k=18),  а также стоимость книг  (Стоимость_без_НДС) без него. Значения округлить до двух знаков после запятой. В запросе для расчета НДС(tax)  и Стоимости без НДС(S_without_tax) использовать следующие формулы:\n\\[tax= {{S *{ k \\over 100}} \\over {1+{k\\over 100}}},\\]\n\\[S\\_without\\_tax= {{S} \\over {1+{k\\over 100}}}\\]\nРезультат\n+------------------+-----------+---------+-------------------+\n| author           | Стоимость | НДС     | Стоимость_без_НДС |\n+------------------+-----------+---------+-------------------+\n| Булгаков М.А.    | 4715.47   | 719.31  | 3996.16           |\n| Достоевский Ф.М. | 11802.03  | 1800.31 | 10001.72          |\n| Есенин С.А.      | 9750.00   | 1487.29 | 8262.71           |\n+------------------+-----------+---------+-------------------+\n\n\nПояснение\nИмена столбцов, присвоенные им с помощью AS, нельзя использовать в выражениях, используйте названия столбцов исходной таблицы.\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1063545,
                "text": {
                    "text": "Вычисления по таблице целиком\nГрупповые функции позволяют вычислять итоговые значения по всей таблице. Например, можно посчитать общее количество книг на складе, вычислить суммарную стоимость и пр. Для этого после ключевого слова SELECT указывается групповая функция для выражения или имени столбца, а ключевые слова GROUP BY опускаются.\nПример\nПосчитать количество экземпляров книг на складе.\nЗапрос:\nSELECT SUM(amount) AS Количество\nFROM book;\nРезультат:\n+------------+\n| Количество |\n+------------+\n| 46         |\n+------------+ \nРезультатом таких запросов является единственная строка с вычисленными по таблице значениями.\n Пример\nПосчитать общее количество экземпляров книг на складе и их стоимость .\nЗапрос:\nSELECT SUM(amount) AS Количество, \n    SUM(price * amount) AS Стоимость\nFROM book;\nРезультат:\n+------------+-----------+\n| Количество | Стоимость |\n+------------+-----------+\n| 46         | 26267.50  |\n+------------+-----------+\n\nЗадание\nВывести  цену самой дешевой книги, цену самой дорогой и среднюю цену уникальных книг на складе. Названия столбцов Минимальная_цена, Максимальная_цена, Средняя_цена соответственно. Среднюю цену округлить до двух знаков после запятой.\nПояснение. В задании нужно посчитать среднюю цену уникальных книг на складе, а не среднюю цену всех экземпляров книг.\nРезультат\n+------------------+-------------------+--------------+\n| Минимальная_цена | Максимальная_цена | Средняя_цена |\n+------------------+-------------------+--------------+\n| 460.00           | 799.01            | 600.17       |\n+------------------+-------------------+--------------+\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1063582,
                "text": {
                    "text": "Выборка данных по условию, групповые функции\nВ запросы с групповыми функциями можно включать условие отбора строк, которое в обычных запросах записывается после WHERE. В запросах с групповыми функциями вместо WHERE используется ключевое слово HAVING , которое размещается после оператора GROUP BY.\nПример\nНайти минимальную и максимальную цену книг всех авторов, общая стоимость книг которых больше 5000.\nЗапрос:\nSELECT author,\n    MIN(price) AS Минимальная_цена, \n    MAX(price) AS Максимальная_цена\nFROM book\nGROUP BY author\nHAVING SUM(price * amount) > 5000; \nРезультат:\n+------------------+------------------+-------------------+\n| author           | Минимальная_цена | Максимальная_цена |\n+------------------+------------------+-------------------+\n| Достоевский Ф.М. | 460.00           | 799.01            |\n| Есенин С.А.      | 650.00           | 650.00            |\n+------------------+------------------+-------------------+\nТакже в запросах с группировкой можно сортировать данные.\n Пример\nНайти минимальную и максимальную цену книг всех авторов, общая стоимость книг которых больше 5000. Результат вывести по убыванию минимальной цены.\nЗапрос:\nSELECT author,\n    MIN(price) AS Минимальная_цена, \n    MAX(price) AS Максимальная_цена\nFROM book\nGROUP BY author\nHAVING SUM(price * amount) > 5000 \nORDER BY Минимальная_цена DESC;\nРезультат:\n+------------------+------------------+-------------------+\n| author           | Минимальная_цена | Максимальная_цена |\n+------------------+------------------+-------------------+\n| Есенин С.А.      | 650.00           | 650.00            |\n| Достоевский Ф.М. | 460.00           | 799.01            |\n+------------------+------------------+-------------------+\nПояснение\nПри указании столбца, по которому выполняется сортировка, если столбцу присвоено имя  с помощью AS, можно использовать это имя.\n\nЗадание\nВычислить среднюю цену и суммарную стоимость тех книг, количество экземпляров которых принадлежит интервалу от 5 до 14, включительно. Столбцы назвать Средняя_цена и Стоимость, значения округлить до 2-х знаков после запятой.\nРезультат\n+--------------+-----------+\n| Средняя_цена | Стоимость |\n+--------------+-----------+\n| 493.67       | 12107.50  |\n+--------------+-----------+\n\nПояснение\nЕсли в запросе с групповыми функциями отсутствует GROUP BY, то для отбора записей используется ключевое слово WHERE.\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1280310,
                "text": {
                    "text": "Выборка данных по условию, групповые функции, WHERE и HAVING\nДля этого урока теоретическая часть подготовлена Alexandra Klinnikova, спасибо большое!\nWHERE и HAVING могут использоваться в одном запросе. При этом необходимо учитывать порядок выполнения  SQL запроса на выборку на СЕРВЕРЕ:\n\nFROM\nWHERE\nGROUP BY\nHAVING\nSELECT\nORDER BY\n\nСначала определяется таблица, из которой выбираются данные (FROM), затем из этой таблицы отбираются записи в соответствии с условием  WHERE, выбранные данные агрегируются (GROUP BY),  из агрегированных записей выбираются те, которые удовлетворяют условию после HAVING. Потом формируются данные результирующей выборки, как это указано после SELECT ( вычисляются выражения, присваиваются имена и пр. ). Результирующая выборка сортируется, как указано после ORDER BY.\nВажно! Порядок ВЫПОЛНЕНИЯ запросов - это не порядок ЗАПИСИ ключевых слов в запросе на выборку. Порядок записи (синтаксис запроса) остается таким же, как рассматривался ранее в курсе. Порядок ВЫПОЛНЕНИЯ  нужен для того, чтобы понять, почему, например, в WHERE нельзя использовать имена выражений из SELECT. Просто SELECT выполняется компилятором позже, чем WHERE, поэтому ему неизвестно, какое там выражение написано.\nПример\nВывести максимальную и минимальную цену книг каждого автора, кроме Есенина, количество экземпляров книг которого больше 10. \nSELECT author,\n    MIN(price) AS Минимальная_цена,\n    MAX(price) AS Максимальная_цена\nFROM book\nWHERE author <> 'Есенин С.А.'\nGROUP BY author\nHAVING SUM(amount) > 10;\nРезультат:\n+------------------+------------------+-------------------+\n| author           | Минимальная_цена | Максимальная_цена |\n+------------------+------------------+-------------------+\n| Достоевский Ф.М. | 460.00           | 799.01            |\n+------------------+------------------+-------------------+\nДругим способом решения примера является запрос:\nSELECT author,\n    MIN(price) AS Минимальная_цена,\n    MAX(price) AS Максимальная_цена\nFROM book\nGROUP BY author\nHAVING SUM(amount) > 10 AND author <> 'Есенин С.А.';\nНе смотря на то что результат будет одинаковым, так делать не рекомендуется. «Потому что как написано - запрос сначала выбирает всех авторов, потом выводит данные, рассчитывая минимальное и максимальное значение цены для каждого, и только после всего убирает Есенина. Можно убрать Есенина в данном случае раньше и не использовать ресурсы базы для расчета его минимального и максимального значения, как это сделано в первом варианте. На небольшой базе быстродействия не ощутить, но если выполнять такое на продуктивной, то второй вариант значительно проигрывает...»[Alexandra Klinnikova].\nЗадание\nПосчитать стоимость всех экземпляров каждого автора без учета книг «Идиот» и «Белая гвардия». В результат включить только тех авторов, у которых суммарная стоимость книг (без учета книг «Идиот» и «Белая гвардия») более 5000 руб. Вычисляемый столбец назвать Стоимость. Результат отсортировать по убыванию стоимости.\nРезультат\n+------------------+-----------+\n| author           | Стоимость |\n+------------------+-----------+\n| Есенин С.А.      | 9750.00   |\n| Достоевский Ф.М. | 7202.03   |\n+------------------+-----------+\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |\n| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |\n| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1061954,
                "text": {
                    "text": "Задание\nПридумайте один или несколько запросов к нашей таблице book, используя групповые функции. Проверьте, правильно ли они работают.\nПри желании можно формулировку запросов  разместить в комментариях. \nРазмещенные задания можно использовать для закрепления материала урока.\nОценивайте понравившиеся Вам запросы.\nВ последнем модуле создан отдельный урок, в котором мы разместим запросы, набравшие наибольшее количество лайков. \nСтруктура и наполнение таблицы book:\n\n[TABLE]\n",
                    "tables": [
                        "{\"0\":{\"0\":\"book_id\",\"1\":\"INT PRIMARY KEY AUTO_INCREMENT\",\"2\":\"1\",\"3\":\"2\",\"4\":\"3\",\"5\":\"4\",\"6\":\"5\",\"7\":\"6\"},\"1\":{\"0\":\"title\",\"1\":\"VARCHAR(50)\",\"2\":\"Мастер и Маргарита\",\"3\":\"Белая гвардия\",\"4\":\"Идиот\",\"5\":\"Братья Карамазовы\",\"6\":\"Игрок\",\"7\":\"Стихотворения и поэмы\"},\"2\":{\"0\":\"author\",\"1\":\"VARCHAR(30)\",\"2\":\"Булгаков М.А.\",\"3\":\"Булгаков М.А.\",\"4\":\"Достоевский Ф.М.\",\"5\":\"Достоевский Ф.М.\",\"6\":\"Достоевский Ф.М.\",\"7\":\"Есенин С.А.\"},\"3\":{\"0\":\"price\",\"1\":\"DECIMAL(8,2)\",\"2\":\"670.99\",\"3\":\"540.50\",\"4\":\"460.00\",\"5\":\"799.01\",\"6\":\"480.50\",\"7\":\"650.00\"},\"4\":{\"0\":\"amount\",\"1\":\"INT\",\"2\":\"3\",\"3\":\"5\",\"4\":\"10\",\"5\":\"3\",\"6\":\"10\",\"7\":\"15\"}}"
                    ]
                }
            }
        ]
    }
]