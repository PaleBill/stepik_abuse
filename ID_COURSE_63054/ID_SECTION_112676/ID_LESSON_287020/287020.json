[
    {
        "id_lesson": 287020,
        "steps": [
            {
                "id_step": 1069062,
                "text": {
                    "text": "Содержание урока\nSQL позволяет не только выбирать данные из таблиц базы данных, но и корректировать информацию в них. Для этого используются запросы корректировки данных, с помощью которых можно:\n\nсоздать пустую таблицу;\nдобавить в таблицу записи как совокупность значений;\nдобавить записи из другой таблицы;\nдобавить записи из другой таблицы, используя вложенный запрос;\nизменить значения в одном столбце;\nизменить значения в нескольких столбцах;\nизменить данные, используя несколько таблиц;\nудалить записи из таблицы;\nсоздать таблицу на основе данных других таблиц.\n\nНа данном уроке будут рассматриваться запросы для реализации типичных для склада действий: \n\nполучение нового товара (добавление, обновление, удаление данных);\nпродажа товара (обновление данных);\nформирование заказа на новый товар (создание таблицы).\n\nСтруктура и наполнение таблицы\nВ запросах будет участвовать таблица book(создание, заполнение):\n\n[TABLE]\n",
                    "tables": [
                        "{\"0\":{\"0\":\"book_id\",\"1\":\"INT PRIMARY KEY AUTO_INCREMENT\",\"2\":\"1\",\"3\":\"2\",\"4\":\"3\",\"5\":\"4\",\"6\":\"5\"},\"1\":{\"0\":\"title\",\"1\":\"VARCHAR(50)\",\"2\":\"Мастер и Маргарита\",\"3\":\"Белая гвардия\",\"4\":\"Идиот\",\"5\":\"Братья Карамазовы\",\"6\":\"Стихотворения и поэмы\"},\"2\":{\"0\":\"author\",\"1\":\"VARCHAR(30)\",\"2\":\"Булгаков М.А.\",\"3\":\"Булгаков М.А.\",\"4\":\"Достоевский Ф.М.\",\"5\":\"Достоевский Ф.М.\",\"6\":\"Есенин С.А.\"},\"3\":{\"0\":\"price\",\"1\":\"DECIMAL(8,2)\",\"2\":\"670.99\",\"3\":\"540.50\",\"4\":\"460.00\",\"5\":\"799.01\",\"6\":\"650.00\"},\"4\":{\"0\":\"amount\",\"1\":\"INT\",\"2\":\"3\",\"3\":\"5\",\"4\":\"10\",\"5\":\"2\",\"6\":\"15\"}}"
                    ]
                }
            },
            {
                "id_step": 1069103,
                "text": {
                    "text": "Создание пустой таблицы\nСоздание таблицы осуществляется с помощью запроса CREATE, подробно рассмотренного в первом уроке модуля.\nЗадание\nСоздать таблицу поставка (supply), которая имеет ту же структуру, что и таблиц book.\n\n[TABLE]\n",
                    "tables": [
                        "{\"0\":{\"0\":\"Поле\",\"1\":\"supply_id\",\"2\":\"title\",\"3\":\"author\",\"4\":\"price\",\"5\":\"amount\"},\"1\":{\"0\":\"Тип, описание\",\"1\":\"INT PRIMARY KEY AUTO_INCREMENT\",\"2\":\"VARCHAR(50)\",\"3\":\"VARCHAR(30)\",\"4\":\"DECIMAL(8, 2)\",\"5\":\"INT\"}}"
                    ]
                }
            },
            {
                "id_step": 1069208,
                "text": {
                    "text": "Добавление записей в таблицу\nДобавление одной записи в таблицу осуществляется с помощью запроса INSERT, подробно рассмотренного в первом уроке. Запросы обязательно разделять точкой с запятой.\nДопускается вставка нескольких записей одновременно, для этого используется SQL запрос следующего вида:\nINSERT INTO имя_таблицы(столбец_1, столбец_2, ..., столбец_N)\nVALUES\n    (значение_1_1, значение_1_2, ..., значение_1_N),\n    (значение_2_1, значение_2_2, ..., значение_2_N),\n    ...\n    (значение_M_1, значение_M_2, ..., значение_M_N);\n\nНапример, чтобы добавить в таблицу book две новые записи используется запрос:\nINSERT INTO book (title, author, price, amount) \nVALUES \n    ('Война и мир','Толстой Л.Н.', 1070.20, 2),\n    ('Анна Каренина', 'Толстой Л.Н.', 599.90, 3);\nЗадание\nЗанесите в таблицу supply четыре записи, чтобы получилась следующая таблица:\n\n[TABLE]\n\nПояснение\nДля просмотра полученной таблицы после запросов (запроса) на добавление  вставить запрос на выборку всех данных из таблицы supply.\n\nРезультат\nAffected rows: 1\nAffected rows: 1\nAffected rows: 1\nAffected rows: 1\nQuery result:\n+-----------+----------------+------------------+--------+--------+\n| supply_id | title          | author           | price  | amount |\n+-----------+----------------+------------------+--------+--------+\n| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |\n| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |\n| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |\n| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |\n+-----------+----------------+------------------+--------+--------+\n",
                    "tables": [
                        "{\"0\":{\"0\":\"supply_id\",\"1\":\"1\",\"2\":\"2\",\"3\":\"3\",\"4\":\"4\"},\"1\":{\"0\":\"title\",\"1\":\"Лирика\",\"2\":\"Черный человек\",\"3\":\"Белая гвардия\",\"4\":\"Идиот\"},\"2\":{\"0\":\"author\",\"1\":\"Пастернак Б.Л.\",\"2\":\"Есенин С.А.\",\"3\":\"Булгаков М.А.\",\"4\":\"Достоевский Ф.М.\"},\"3\":{\"0\":\"price\",\"1\":\"518.99\",\"2\":\"570.20\",\"3\":\"540.50\",\"4\":\"360.80\"},\"4\":{\"0\":\"amount\",\"1\":\"2\",\"2\":\"6\",\"3\":\"7\",\"4\":\"3\"}}"
                    ]
                }
            },
            {
                "id_step": 1069293,
                "text": {
                    "text": "Добавление записей из другой таблицы\nС помощью запроса на добавление можно не только добавить в таблицу конкретные значения (список VALUES), но и записи из другой таблицы, отобранные с помощью запроса на выборку.  В этом случае вместо раздела VALUES записывается запрос на выборку, начинающийся с SELECT.  В нем можно использовать WHERE, GROUP BY, ORDER BY.\nПравила соответствия между полями таблицы и вставляемыми значениями из запроса:\n\nколичество полей в таблице и количество полей в запросе должны совпадать;\nдолжно существовать прямое соответствие между позицией одного и того же элемента в обоих списках, поэтому первый столбец запроса должен относиться к первому столбцу в списке столбцов таблицы, второй – ко второму столбцу и т.д.\n типы столбцов запроса должны быть совместимы с типами данных соответствующих столбцов таблицы ( целое число можно занести в поле типа DECIMAL, обратная операция – недопустима).\n\nПример\nЗанести все книги из таблицы supply в таблицу book.\nЗапрос:\nINSERT INTO book (title, author, price, amount) \nSELECT title, author, price, amount \nFROM supply;\n\nSELECT * FROM book;\nРезультат:\nAffected rows: 4\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n| 6       | Лирика                | Пастернак Б.Л.   | 518.99 | 2      |\n| 7       | Черный человек        | Есенин С.А.      | 570.20 | 6      |\n| 8       | Белая гвардия         | Булгаков М.А.    | 540.50 | 7      |\n| 9       | Идиот                 | Достоевский Ф.М. | 360.80 | 3      |\n+---------+-----------------------+------------------+--------+--------+\nAffected rows: 9\nС помощью этого запроса в таблицу book включены все книги из supply, даже те, которые в book уже есть («Белая гвардия» и «Идиот»). В результате в таблице одна и та же книга, например «Белая гвардия», имеет код 2 и 8. Для реляционной модели это нежелательная ситуация. Устранить эту проблему можно с помощью вложенных запросов, которые будут рассмотрены в следующем шаге.\nЗадание\nДобавить из таблицы supply в таблицу book, все книги, кроме книг, написанных Булгаковым М.А. и Достоевским Ф.М.\nРезультат\nAffected rows: 2\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n| 6       | Лирика                | Пастернак Б.Л.   | 518.99 | 2      |\n| 7       | Черный человек        | Есенин С.А.      | 570.20 | 6      |\n+---------+-----------------------+------------------+--------+--------+\n\nПояснение\nЗадание нужно выполнить без вложенных запросов.\n\nСтруктура и наполнение таблиц book и supply\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n+-----------+----------------+------------------+--------+--------+\n| supply_id | title          | author           | price  | amount |\n+-----------+----------------+------------------+--------+--------+\n| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |\n| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |\n| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |\n| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |\n+-----------+----------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1069521,
                "text": {
                    "text": "Добавление записей, вложенные запросы\nВ запросах на добавление можно использовать вложенные запросы.\nПример\nЗанести из таблицы supply в таблицу book только те книги, названия которых отсутствуют в таблице book.\nЗапрос:\nINSERT INTO book (title, author, price, amount) \nSELECT title, author, price, amount \nFROM supply\nWHERE title NOT IN (\n        SELECT title \n        FROM book\n      );\n\nSELECT * FROM book;\nРезультат:\nAffected rows: 2\n\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n| 6       | Лирика                | Пастернак Б.Л.   | 518.99 | 2      |\n| 7       | Черный человек        | Есенин С.А.      | 570.20 | 6      |\n+---------+-----------------------+------------------+--------+--------+\nВложенным запросом отбираются все названия книг, которые есть в таблице book. Основным запросом SELECT из таблицы supply выбираются книги, названия которых нет в результате вложенного запроса. Отобранные записи добавляются в конец таблицы bookзапросом на добавление INSERT.\nЗадание\nЗанести из таблицы supply в таблицу book только те книги, авторов которых нет в  book.\nРезультат\nAffected rows: 1\n\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n| 6       | Лирика                | Пастернак Б.Л.   | 518.99 | 2      |\n+---------+-----------------------+------------------+--------+--------+\n\nСтруктура и наполнение таблиц book и supply\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n+-----------+----------------+------------------+--------+--------+\n| supply_id | title          | author           | price  | amount |\n+-----------+----------------+------------------+--------+--------+\n| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |\n| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |\n| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |\n| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |\n+-----------+----------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1071894,
                "text": {
                    "text": "Запросы на обновление\nПод обновлением данных подразумевается изменение значений в существующих записях таблицы. При этом возможно как изменение значений полей в группе строк (даже всех строк таблицы), так и правка значения поля отдельной строки.\nИзменение записей в таблице реализуется с помощью запроса UPDATE. Простейший запрос на  обновление выглядит так:\nUPDATE таблица SET поле = выражение\nгде \nтаблица – имя таблицы, в которой будут проводиться изменения;\nполе – поле таблицы, в которое будет внесено изменение;\nвыражение – выражение,  значение которого будет занесено в поле.\nПример\nУменьшить на 30% цену книг в таблице book.\nЗапрос:\nUPDATE book \nSET price = 0.7 * price;\n\nSELECT * FROM book;\nРезультат:\nAffected rows: 5\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 469.69 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 378.35 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 322.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 559.31 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 455.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\nС помощью запросов на обновление можно изменять не все записи в таблице (как в предыдущем запросе), а только часть из них. Для этого в запрос включается ключевое слово WHERE, после которого указывается условие отбора строк для изменения.\nПример\nУменьшить на 30% цену тех книг в таблице book, количество которых меньше 5.\nЗапрос:\nUPDATE book \nSET price = 0.7 * price \nWHERE amount < 5;\n\nSELECT * FROM book;\nРезультат:\nAffected rows: 2\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 469.69 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 559.31 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\nВ этом запросе обновляется только 2 записи (цена книг «Мастер и Маргарита» и «Братья Карамазовы»).\nЗадание\nУменьшить на 10% цену тех книг в таблице book, количество которых принадлежит интервалу от 5 до 10, включая границы.\nРезультат\nAffected rows: 2\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 486.45 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 414.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1071978,
                "text": {
                    "text": "Запросы на обновление нескольких столбцов\nЗапросом UPDATE можно обновлять значения нескольких столбцов одновременно. В этом случае простейший запрос будет выглядеть так:\nUPDATE таблица SET поле1 = выражение1, поле2 = выражение2\nНа складе, кроме хранения и получения книг, выполняется их оптовая продажа. Для реализации этого действия включим дополнительный столбец buy  в таблицу book:\n\n[TABLE]\n\nПример\nВ столбце buy покупатель указывает количество книг, которые он хочет приобрести. Для каждой книги, выбранной покупателем, необходимо уменьшить ее количество на складе на указанное в столбцеbuy количество, а в столбец buy занести 0.\nЗапрос:\nUPDATE book \nSET amount = amount - buy,\n    buy = 0;\n\nSELECT * FROM book;\nРезультат:\nAffected rows: 3\nQuery result:\n+---------+-----------------------+------------------+--------+--------+-----+\n| book_id | title                 | author           | price  | amount | buy |\n+---------+-----------------------+------------------+--------+--------+-----+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 2      | 0   |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 2      | 0   |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | -3     | 0   |\n+---------+-----------------------+------------------+--------+--------+-----+\nКак видно из таблицы, без проверки данных, которые занесены в столбец,  нельзя запускать запрос на обновление (может получиться отрицательное значение количества).\nЗадание\nВ таблице book необходимо скорректировать значение для покупателя в столбце buy таким образом, чтобы оно не превышало количество экземпляров книг, указанных в столбце amount. А цену тех книг, которые покупатель не заказывал, снизить на 10%.\nРезультат\nAffected rows: 3\nQuery result:\n+---------+-----------------------+------------------+--------+--------+-----+\n| book_id | title                 | author           | price  | amount | buy |\n+---------+-----------------------+------------------+--------+--------+-----+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 603.89 | 3      | 0   |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 719.11 | 2      | 0   |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 15  |\n+---------+-----------------------+------------------+--------+--------+-----+\n\nПояснение\nЗапрос на обновление количества книг должен корректировать значения в столбце buy  таблицы book следующим образом:\n\nесли покупатель заказал количество книг больше, чем есть на складе, то заменить значение buy на имеющееся на складе количество amount;\nесли покупатель хочет купить количество книг меньшее или равное количеству книг на складе, то значение buy изменять не надо.\n\nДля реализации этого запроса можно  использовать функцию if().  Синтаксис раздела SET при использовании функции if() следующий:\nSET столбец = IF(условие, выражение_1, выражение_2)\nВыполняется этот оператор так:\n\nсначала вычисляется условие;\nесли условие ИСТИНА, то вычисляется выражение_1, в противном случае (если условие ЛОЖНО) вычисляется выражение_2;\nв столбец заносится результат выполнения функции (либо значение выражения_1, либо значение выражения_2 в зависимости от условия).\n\nНапример, для увеличения на 10% только цен книг Булгакова используется запрос:\nUPDATE book \nSET price = IF(author = \"Булгаков М.А.\", price * 1.1, price);\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+-----+\n| book_id | title                 | author           | price  | amount | buy |\n+---------+-----------------------+------------------+--------+--------+-----+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 3   |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 8   |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 18  |\n+---------+-----------------------+------------------+--------+--------+-----+\n",
                    "tables": [
                        "{\"0\":{\"0\":\"book_id\",\"1\":\"INT PRIMARY KEY AUTO_INCREMENT\",\"2\":\"1\",\"3\":\"2\",\"4\":\"3\",\"5\":\"4\",\"6\":\"5\"},\"1\":{\"0\":\"title\",\"1\":\"VARCHAR(50)\",\"2\":\"Мастер и Маргарита\",\"3\":\"Белая гвардия\",\"4\":\"Идиот\",\"5\":\"Братья Карамазовы\",\"6\":\"Стихотворения и поэмы\"},\"2\":{\"0\":\"author\",\"1\":\"VARCHAR(30)\",\"2\":\"Булгаков М.А.\",\"3\":\"Булгаков М.А.\",\"4\":\"Достоевский Ф.М.\",\"5\":\"Достоевский Ф.М.\",\"6\":\"Есенин С.А.\"},\"3\":{\"0\":\"price\",\"1\":\"DECIMAL(8,2)\",\"2\":\"670.99\",\"3\":\"540.50\",\"4\":\"460.00\",\"5\":\"799.01\",\"6\":\"650.00\"},\"4\":{\"0\":\"amount\",\"1\":\"INT\",\"2\":\"3\",\"3\":\"5\",\"4\":\"10\",\"5\":\"2\",\"6\":\"15\"},\"5\":{\"0\":\"buy\",\"1\":\"int\",\"2\":\"0\",\"3\":\"3\",\"4\":\"8\",\"5\":\"0\",\"6\":\"18\"}}"
                    ]
                }
            },
            {
                "id_step": 1070653,
                "text": {
                    "text": "Запросы на обновление нескольких таблиц \nВ запросах на обновление можно использовать несколько таблиц, но тогда\n\nдля столбцов, имеющих одинаковые имена, необходимо указывать имя таблицы, к которой они относятся, например, book.price – столбец price из таблицы book, supply.price – столбец price из таблицы supply;\nвсе таблицы, используемые в запросе, нужно перечислить после ключевого слова UPDATE;\nв запросе обязательно условие WHERE, в котором указывается условие при котором обновляются данные.\n\nПример\nЕсли в таблице supply  есть те же книги, что и в таблице book, добавлять эти книги в таблицу book не имеет смысла. Необходимо увеличить их количество на значение столбца amountтаблицы supply.\nЗапрос:\nUPDATE book, supply \nSET book.amount = book.amount + supply.amount\nWHERE book.title = supply.title AND book.author = supply.author;\n\nSELECT * FROM book;\nРезультат:\nAffected rows: 2\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 12     |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 13     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\nВ этом запросе увеличилось количество двух книг: «Белая гвардия», которая в supply имеет ту же цену, и «Идиот», но цена этой книги в таблицах book и supply отличается. Для этой книги нужно пересчитать цену.\nЗадание\nДля тех книг в таблице book , которые есть в таблице supply, не только увеличить их количество в таблице book ( увеличить их количество на значение столбца amountтаблицы supply), но и пересчитать их цену (для каждой книги найти сумму цен из таблиц book и supply и разделить на 2).\nРезультат\nAffected rows: 2\nQuery result:\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 12     |\n| 3       | Идиот                 | Достоевский Ф.М. | 410.40 | 13     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n\nПояснение\nПересчет для книг с одинаковым названием и ценой не повлияет на результат, поэтому в запросе не обязательно рассматривать два случая: когда цена у одинаковых книг равна и когда нет.\n\nСтруктура и наполнение таблиц book и supply\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n+-----------+----------------+------------------+--------+--------+\n| supply_id | title          | author           | price  | amount |\n+-----------+----------------+------------------+--------+--------+\n| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |\n| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |\n| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |\n| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |\n+-----------+----------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1073450,
                "text": {
                    "text": "Запросы на удаление\nЗапросы корректировки данных позволяют удалить одну или несколько записей из  таблицы. Простейший запрос на удаление имеет вид:\nDELETE FROM таблица;\nЭтот запрос удаляет все записи из указанной после FROM таблицы.\nПример\nПосле того, как информация о книгах из таблицы supply перенесена в book , необходимо очистить таблицу  supply.\nЗапрос:\nDELETE FROM supply;\n\nSELECT * FROM supply;\nРезультат:\nAffected rows: 4\nAffected rows: 0\nИз таблицы удалены все записи. Запрос на выборку отобрал 0 записей.\nЗапрос на удаления позволяет удалить не все записи таблицы, а только те, которые удовлетворяют условию, указанному после ключевого слова WHERE:\nDELETE FROM таблица\nWHERE условие;\nПример\nУдалить из таблицы supply все книги, названия которых есть в таблице book.\nЗапрос:\nDELETE FROM supply \nWHERE title IN (\n        SELECT title \n        FROM book\n      );\n\n\nSELECT * FROM supply;\nРезультат:\nAffected rows: 2\n\nQuery result:\n+-----------+--------------------------+------------------+--------+--------+\n| supply_id | title                    | author           | price  | amount |\n+-----------+--------------------------+------------------+--------+--------+\n| 1         | Лирика                   | Пастернак Б.Л.   | 518.99 | 2      |\n| 2         | Черный человек           | Есенин С.А.      | 570.20 | 6      |\n+-----------+--------------------------+------------------+--------+--------+\nИз таблицы supply удалены две записи о книгах «Белая гвардия» и «Идиот».\nЗадание\nУдалить из таблицы supply книги тех авторов, общее количество экземпляров книг которых в таблице book превышает 10.\nРезультат\nAffected rows: 2\n\nQuery result:\n+-----------+---------------+----------------+--------+--------+\n| supply_id | title         | author         | price  | amount |\n+-----------+---------------+----------------+--------+--------+\n| 1         | Лирика        | Пастернак Б.Л. | 518.99 | 2      |\n| 3         | Белая гвардия | Булгаков М.А.  | 540.50 | 7      |\n+-----------+---------------+----------------+--------+--------+\n\nСтруктура и наполнение таблиц book и supply\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n+-----------+----------------+------------------+--------+--------+\n| supply_id | title          | author           | price  | amount |\n+-----------+----------------+------------------+--------+--------+\n| 1         | Лирика         | Пастернак Б.Л.   | 518.99 | 2      |\n| 2         | Черный человек | Есенин С.А.      | 570.20 | 6      |\n| 3         | Белая гвардия  | Булгаков М.А.    | 540.50 | 7      |\n| 4         | Идиот          | Достоевский Ф.М. | 360.80 | 3      |\n+-----------+----------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1073587,
                "text": {
                    "text": "Запросы на создание таблицы\nНовая таблица может быть создана на основе данных из другой таблицы. Для этого используется запрос SELECT, результирующая таблица которого и будет новой таблицей базы данных. При этом имена столбцов запроса становятся именами столбцов новой таблицы. Запрос на создание новой таблицы имеет вид:\nCREATE TABLE имя_таблицы AS\nSELECT ...\nПример\nСоздать таблицу заказ (ordering), куда включить авторов и названия тех книг, количество экземпляров которых в таблице book меньше 4. Для всех книг указать одинаковое количество экземпляров 5.\nЗапрос:\nCREATE TABLE ordering AS\nSELECT author, title, 5 AS amount\nFROM book\nWHERE amount < 4;\n\nSELECT * FROM ordering;\nРезультат:\nAffected rows: 2\nQuery result:\n+------------------+--------------------+--------+\n| author           | title              | amount |\n+------------------+--------------------+--------+\n| Булгаков М.А.    | Мастер и Маргарита | 5      |\n| Достоевский Ф.М. | Братья Карамазовы  | 5      |\n+------------------+--------------------+--------+\nПри создании таблицы можно использовать вложенные запросы как после SELECT, так и после WHERE.\nПример\nСоздать таблицу заказ (ordering), куда включить авторов и названия тех книг, количество экземпляров которых в таблице book меньше 4. Для всех книг указать одинаковое значение - среднее количество экземпляров книг в таблице book.\nЗапрос:\nCREATE TABLE ordering AS\nSELECT author, title, \n   (\n    SELECT ROUND(AVG(amount)) \n    FROM book\n   ) AS amount\nFROM book\nWHERE amount < 4;\n\nSELECT * FROM ordering;\nРезультат:\nAffected rows: 2\nQuery result:\n+------------------+--------------------+--------+\n| author           | title              | amount |\n+------------------+--------------------+--------+\n| Булгаков М.А.    | Мастер и Маргарита | 7      |\n| Достоевский Ф.М. | Братья Карамазовы  | 7      |\n+------------------+--------------------+--------+\nЗадание\nСоздать таблицу заказ (ordering), куда включить авторов и названия тех книг, количество экземпляров которых в таблице book меньше среднего количества экземпляров книг в таблице book. В таблицу включить столбец   amount, в котором для всех книг указать одинаковое значение - среднее количество экземпляров книг в таблице book.\nРезультат\nAffected rows: 3\nQuery result:\n+------------------+--------------------+--------+\n| author           | title              | amount |\n+------------------+--------------------+--------+\n| Булгаков М.А.    | Мастер и Маргарита | 7      |\n| Булгаков М.А.    | Белая гвардия      | 7      |\n| Достоевский Ф.М. | Братья Карамазовы  | 7      |\n+------------------+--------------------+--------+\n\nСтруктура и наполнение таблицы book\n+---------+-----------------------+------------------+--------+--------+\n| book_id | title                 | author           | price  | amount |\n+---------+-----------------------+------------------+--------+--------+\n| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |\n| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |\n| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |\n| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      |\n| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |\n+---------+-----------------------+------------------+--------+--------+\n",
                    "tables": []
                }
            },
            {
                "id_step": 1071431,
                "text": {
                    "text": "Задание\nПридумайте один или несколько запросов корректировки данных к  таблицамbook и  supply . Проверьте, правильно ли они работают.\nПри желании можно формулировку запросов  разместить в комментариях. \nРазмещенные задания можно использовать для закрепления материала урока.\nОценивайте понравившиеся Вам запросы.\nВ последнем модуле создан отдельный урок, в котором мы разместим запросы, набравшие наибольшее количество лайков.\nСтруктура и наполнение таблиц:\nТаблица book\n\n[TABLE]\n\nТаблица supply :\n\n[TABLE]\n",
                    "tables": [
                        "{\"0\":{\"0\":\"book_id\",\"1\":\"1\",\"2\":\"2\",\"3\":\"3\",\"4\":\"4\",\"5\":\"5\"},\"1\":{\"0\":\"title\",\"1\":\"Мастер и Маргарита\",\"2\":\"Белая гвардия\",\"3\":\"Идиот\",\"4\":\"Братья Карамазовы\",\"5\":\"Стихотворения и поэмы\"},\"2\":{\"0\":\"author\",\"1\":\"Булгаков М.А.\",\"2\":\"Булгаков М.А.\",\"3\":\"Достоевский Ф.М.\",\"4\":\"Достоевский Ф.М.\",\"5\":\"Есенин С.А.\"},\"3\":{\"0\":\"price\",\"1\":\"670.99\",\"2\":\"540.50\",\"3\":\"460.00\",\"4\":\"799.01\",\"5\":\"650.00\"},\"4\":{\"0\":\"amount\",\"1\":\"3\",\"2\":\"5\",\"3\":\"10\",\"4\":\"2\",\"5\":\"15\"}}",
                        "{\"0\":{\"0\":\"supply_id\",\"1\":\"1\",\"2\":\"2\",\"3\":\"3\",\"4\":\"4\"},\"1\":{\"0\":\"title\",\"1\":\"Лирика\",\"2\":\"Черный человек\",\"3\":\"Белая гвардия\",\"4\":\"Идиот\"},\"2\":{\"0\":\"author\",\"1\":\"Пастернак Б.Л.\",\"2\":\"Есенин С.А.\",\"3\":\"Булгаков М.А.\",\"4\":\"Достоевский Ф.М.\"},\"3\":{\"0\":\"price\",\"1\":\"518.99\",\"2\":\"570.20\",\"3\":\"540.50\",\"4\":\"360.80\"},\"4\":{\"0\":\"amount\",\"1\":\"2\",\"2\":\"6\",\"3\":\"7\",\"4\":\"3\"}}"
                    ]
                }
            }
        ]
    }
]